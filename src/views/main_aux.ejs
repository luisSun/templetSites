<%- include('partials/head.ejs') %>
<%- include('partials/aside.ejs') %>
<section id="main-content">
    <div class="main">
        <div class="article">
            <div class="article-header">
                <h3>Cabeçalho artigo New HD videos</h3>
                <div class="divSearch">
                    <label for="search">Buscar dados</label>
                    <input type="search" id="search" />
                </div>
            </div>
            <div class="article-body content" id="card-container">
                <% for (let i = 0; i < selectedItem.length; i++) { %>
                <div class="card">
                    <div class="card-img">
                        <a href="/watch/<%= selectedItem[i].id %>"><img class="img-thumb" src="<%= selectedItem[i].cover %>.jpg" alt="<%= selectedItem[i].title %>"></a>
                    </div>
                    <div class="card-text">
                        <a href="/watch/<%= selectedItem[i].id %>">
                            <h4><%= selectedItem[i].title.length > 20 ? selectedItem[i].title.substring(0, 42) + '...' : selectedItem[i].title %></h4>
                        </a>
                        <li>
                            <i class="fas fa-star"></i> Atriz: 
                            <% 
                            const atrizes = selectedItem[i].atriz.split(',')
                                .map(atriz => atriz.trim())
                                .filter(atriz => atriz !== '');
                            
                            if (atrizes.length === 1) { %>
                                <%= atrizes[0] %>
                            <% } else if (atrizes.length > 1) { %>
                                <%= atrizes[0] %> e <%= atrizes.length - 1 %> mais
                            <% } %>
                        </li>
                    </div>
                    <div class="rectangle">
                        <h5><%= selectedItem[i].studio.split(',')[0] %></h5>
                    </div>
                </div>
                <% } %>
            </div>
        </div>
    </div>
</section>
</main>
<footer class="pag">
    <div class="pagination">
        <% 
          const firstPages = [1, 2, 3].filter(n => n <= totalPages);
          const lastPages = [totalPages - 2, totalPages - 1, totalPages].filter(n => n > 3 && n <= totalPages);
          const showExtraControls = totalPages > 3;
        %>
      
        <!-- Primeira e Anterior -->
        <% if (page > 1) { %>
          <a href="/main/<%= auxiliar[1] %>/<%= auxiliar[0] %>?page=1">Primeira</a>
          <a href="/main/<%= auxiliar[1] %>/<%= auxiliar[0] %>?page=<%= page - 1 %>">Anterior</a>
        <% } %>
      
        <!-- Primeiras páginas -->
        <% firstPages.forEach(i => { %>
          <a href="/main/<%= auxiliar[1] %>/<%= auxiliar[0] %>?page=<%= i %>" class="<%= page === i ? 'active' : '' %>"><%= i %></a>
        <% }) %>
      
        <% if (showExtraControls) { %>
          <!-- Reticências / Página atual -->
          <% if (page > 4 && page <= totalPages - 3) { %>
            <span>...</span>
            <a href="/main/<%= auxiliar[1] %>/<%= auxiliar[0] %>?page=<%= page %>" class="active"><%= page %></a>
            <span>...</span>
          <% } else if (page === 4) { %>
            <a href="/main/<%= auxiliar[1] %>/<%= auxiliar[0] %>?page=4" class="active">4</a>
            <span>...</span>
          <% } else if (page > totalPages - 3) { %>
            <span>...</span>
          <% } %>
        <% } %>
      
        <!-- Últimas páginas -->
        <% lastPages.forEach(i => { %>
          <a href="/main/<%= auxiliar[1] %>/<%= auxiliar[0] %>?page=<%= i %>" class="<%= page === i ? 'active' : '' %>"><%= i %></a>
        <% }) %>
      
        <!-- Seguinte e Última -->
        <% if (page < totalPages) { %>
          <a href="/main/<%= auxiliar[1] %>/<%= auxiliar[0] %>?page=<%= page + 1 %>">Seguinte</a>
          <a href="/main/<%= auxiliar[1] %>/<%= auxiliar[0] %>?page=<%= totalPages %>">Última</a>
        <% } %>
      
        <% if (showExtraControls) { %>
          <!-- Input para ir para página específica -->
          <input type="number" id="goto-page" min="1" max="<%= totalPages %>" placeholder="Página #" style="width:60px;">
          <button onclick="goToPage()">Ir</button>
      
          <!-- Botão de página aleatória -->
          <button onclick="goRandomPage()">?</button>

      <% if (page > 1) { %>
          <a href="/main/<%= auxiliar[1] %>/<%= auxiliar[0] %>?page=<%= page - 1 %>">Anterior</a>
        <% } %>
      
        <% for (let i = 1; i <= totalPages; i++) { %>
          <a href="/main/<%= auxiliar[1] %>/<%= auxiliar[0] %>?page=<%= i %>" class="<%= page === i ? 'active' : '' %>"><%= i %></a>
        <% } %>
      
        <% if (page < totalPages) { %>
          <a href="/main/<%= auxiliar[1] %>/<%= auxiliar[0] %>?page=<%= page + 1 %>">Próxima</a>

        <% } %>
      </div>
</footer>
<div id="show-aside-square" onclick="toggleAside()">☰</div>

<script>
    //Pesquisa Dinamica
    const content = document.querySelector(".content");
    const inputSearch = document.querySelector("input[type='search']");

    const items = <%- JSON.stringify(selectAll) %>;

    inputSearch.oninput = () => {
        content.innerHTML = "";
        const query = inputSearch.value.toLowerCase();
        
        const filteredItems = items.filter(item => item.title.toLowerCase().includes(query) || item.atriz.toLowerCase().includes(query) || item.studio.toLowerCase().includes(query));

        filteredItems.forEach(item => addHTML(item));
    };

    function addHTML(item) {
        const card = document.createElement("div");
        card.classList.add("card");

        const cardImg = document.createElement("div");
        cardImg.classList.add("card-img");
        cardImg.innerHTML = `<a href="/watch/${item.id}"><img class="img-thumb" src="${item.cover}.jpg" alt="${item.title}"></a>`;

        const cardText = document.createElement("div");
        cardText.classList.add("card-text");
        cardText.innerHTML = `<a href="/watch/${item.id}"><h4>${item.title.length > 20 ? item.title.substring(0, 42) + '...' : item.title}</h4></a><li><i class="fas fa-star"></i> Atriz: ${item.atriz}</li>`;

        const rectangle = document.createElement("div");
        rectangle.classList.add("rectangle");
        rectangle.innerHTML = `<h5>${item.studio}</h5>`;

        card.append(cardImg, cardText, rectangle);
        content.append(card);
    }

</script>

</body>
</html>
